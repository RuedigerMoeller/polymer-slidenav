<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="polymer-slidenav" attributes="speed position">
    <template>
        <style>
			     [unresolved] {
				    opacity: 0;
				  }
          :host {
            display: block;
          }
          #menu{
            height: auto;
          }
        </style>
        <div id="toggler" on-tap="{{toggle}}">
            <content select=".tg"></content>
        </div>
        <div id="menu">
            <content select=".menu"></content>                
        </div>
    </template>
    <script>
        Polymer('polymer-slidebar', {
            speed : '0.4s',
            prop : 'height',
            // Fires when an instance of the element is created
            created: function(){},

            // Fires when the element was inserted into the document
            attached: function(){},

            // Fires when the element's initial set of children and siblings are guaranteed to exist
            domReady: function(){},

            // Fires when the element was removed from the document
            detached: function(){},

            // Fires when an attribute was added, removed or updated
            attributeChanged: function(attr, oldVal, newVal){}, 

            // Fires when the "<polymer-element>" has been fully prepared
            ready: function(){
                var len = this.children.length;
                //console.dir(this.children[1])
                for(var i = 0; i < len; i++){
                    if ( this.children[i].classList.contains('menu') ){
                        console.log(this.children[i]);
                        this.menu = this.children[i];
                    }
                }
                console.log('msg')
                this.storeValues();
                
                this.closedH = 0;
                this.hide();
                this.addList();
            },
            storeValues: function(){
                // get the real values of the menu from the DOM in order to inject
                // it into our element with the real original values
            	 /*var h = this.getSize( this.menu, 'height' ),
                    mb = this.getSize( this.menu, 'margin-bottom' ),
                    mt = this.getSize( this.menu, 'margin-top' ),
                    pb = this.getSize( this.menu, 'padding-bottom' ),
                    pt = this.getSize( this.menu, 'padding-top' ); */
               this.openH = this.$.menu.getBoundingClientRect()[this.prop];

               this.setVal(this.openH);
            },
            getSize: function(el, prop){
                return parseInt( getComputedStyle(el).getPropertyValue(prop) );
            },
            hide: function(){
                // get height every time but the first one
                var self = this;
                if ( this.initialized ){
                    this.storeValues();
                }
                // see: http://www.polymer-project.org/docs/polymer/polymer.html#asyncmethod
                this.async(function(){
                    this.$.menu.style.height = 0;
                    this.$.menu.style.overflow = 'hidden';
                    this.state = 'closed';
                    this.tran();
                    this.initialized = true;
                });
            },
            show: function(){
                this.setVal( this.openH );
                this.state = 'open';  
                console.log(this.state) 
            },
            setVal: function(val){
                this.$.menu.style.height = val + 'px';
                console.log( 'height is now' + this.$.menu.style.height )
            },
            toggle: function(e){
                (this.state === 'closed') ? this.show() : this.hide();
            },
            addList: function(){
                var self = this;
                this.$.menu.addEventListener('webkitTransitionEnd', this.removeStyle.bind(this) );
                this.$.menu.addEventListener('transitionEnd', this.removeStyle.bind(this) );
            },
            removeStyle: function(){
                // remove style only if open
                if( this.state === 'open' ){
                    this.$.menu.style.height = 'auto';
                }
            },
            tran: function(){
                this.$.menu.style.webkitTransition = this.prop + ' ' + this.speed;
                this.$.menu.style.transition = this.prop + ' ' + this.speed;
            }
        });
    </script>

</polymer-element>
